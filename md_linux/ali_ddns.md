# 最低成本建站的教程


需要的材料:
1. 阿里云购买的域名
2. 一台低功耗的设备（废弃手机，废弃平板，树莓派zero，或者其他ARM/x86设备，只要你觉得低功耗就行）
3. 公网IP（电信的一般打电话给客服就能申请到，20小时左右会变动一个IP，其他运营商请自行咨询办理）
4. 提前下载好对应平台的jdk文件(其实语言能调用阿里云的api都行，请自行探索)

## 1.首先需要确保自己的IP是否为公网的

1. 进入http://www.net.cn/static/customercare/yourIP.asp 查看自己的IP
2. Windows系统进入cmd/powershell输入: tracert <刚才获取的IP>
3. 如果显示两行，则很大概率说明是拥有公网IP的，因为目前运营商赠送的光猫，很多是和路由器一体的，如果你还接一个路由器就会这样。

## 2.根据情况设置光猫和路由器

0. 如果是只使用一个带局域网功能的光猫，其实要更简单，就是不怎么符合实际情况。
1. 首先把要映射到外网的设备设置为DMZ主机（端口映射在光猫上做，没必要在路由器在设置一次），路由器设置完毕。
2. 根据光猫底下的信息，进入到电信光猫的配置页面，进入高级设置，填写端口映射的信息(端口映射对外设置80或者8080是没有用的，尝试一下就知道了)，IP地址就填写路由器的地址，光猫也设置完成(如果以后要添加新的端口可以在这里设置)
3. 两边都设置完，可以利用上面获取到的公网IP地址测试下：
(1). DMZ主机上安装nginx:`sudo apt-get install nginx `
(2). 修改nginx默认访问端口:`sudo vim /etc/nginx/sites-available/default`;把80端口改成你映射的内网端口
4. 显示两行，则很大概率说明是拥有公网IP的，因为目前运营商赠送的光猫，很多是和路由器一体的，如果你还接一个路由器就会这样。

### 2.根据情况设置光猫和路由器

0. 我这里默认大家都是在原来的光猫上，再接一个路由器吧，这样子就是需要设置:光猫*1，路由器*1。
1. 首先把要映射到外网的设备设置为DMZ主机（如果你喜欢用端口映射也可以），在路由器上设置好，因为不同品牌路由器都不同，这里不详细说明。
2. 根据光猫底下的信息，进入到电信光猫的配置页面，在高级设置里设置端口映射的地址和端口，80和8080一般都不能用，加了也没有意义。ip地址填写你路由器在光猫下的ip即可，在光猫的设备列表中就能查看。
3. 两边都设置完，可以利用1.中设置的DMZ主机进行验证，
    (1). 安装nginx:sudo apt-get install nginx 
    (2). 修改nginx默认访问端口:sudo vim /etc/nginx/sites-available/default;把80端口改成你在2.中设置的对外网映射端口
    (3). 运行nginx:sudo service nginx start
    (4). 如果能正常访问 {公网ip}:端口号 进入nginx默认首页，那说明公网IP已经正常设置好了

### 3.利用阿里ddns实现ip自动解析到域名

1. 其实官方有Java的实例代码：https://help.aliyun.com/document_detail/141482.html?spm=5176.11065259.1996646101.searchclickresult.46fd2881SgUCqH
2. 把准备好的jdk配置到你的设备(注意，这里的设备可以不是你的dmz主机)，把官方的Java代码修改成定时任务的spring boot程序
3. 后台执行 nohup java -jar xx.jar > xyz.log 2&1   & 并输出日志到xyz.log
4. 如果不嫌麻烦，还可以利用/etc/rc.local文件，设置启动执行
5. 这样子就基本上完成了ddns的设置，以后你要连接家里的设备，都可以通过域名了。
6. 设置重启和自动启动程序